<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Biblioteca de PDFs</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<!-- Google Font Bold -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@700&display=swap" rel="stylesheet">
<!-- Lucide Icons -->
<script src="https://unpkg.com/lucide@latest"></script>
<!-- PDF.js para preview -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<style>
    pdfjs {
        display: block;
        margin: 0 auto;
    }
</style>

<style>
body { font-family: 'Inter', sans-serif; background:#f8f9fa; }
.card { border:none; border-radius:16px; box-shadow:0 8px 20px rgba(0,0,0,.08); transition: transform .2s; }
.card:hover { transform: translateY(-5px); }
.sticky-search { position:sticky; top:0; z-index:1020; background:#f8f9fa; padding:1rem 0; }
.search-input { border-radius:14px; padding:12px 16px; font-size:1rem; }

.carousel-inner img { height:180px; object-fit:cover; border-radius:12px; }

h1.header-animated {
  font-size:2.5rem;
  text-align:center;
  margin-bottom:2rem;
  background: linear-gradient(90deg, #4f46e5, #3b82f6, #06b6d4);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: fadeIn 1s ease forwards;
  opacity:0;
}
@keyframes fadeIn {
  to { opacity:1; }
}

.btn-icon { display:flex; align-items:center; justify-content:center; padding:10px; border-radius:12px; font-size:1rem; gap:6px; }

/* Modal styles */
.modal-content { border-radius:16px; }
.pdf-preview-container { height:500px; overflow-y:auto; border:1px solid #dee2e6; border-radius:8px; }
.pdf-controls { display:flex; gap:10px; align-items:center; justify-content:center; margin-top:15px; }

/* Loading spinner */
.spinner-border { width:1.5rem; height:1.5rem; }

/* Notification */
.toast-container { z-index:9999; }
</style>
</head>
<body>

<div class="container py-4">

<!-- Cabeçalho animado -->
<h1 class="header-animated">Biblioteca de PDFs</h1>

<!-- Pesquisa fixa -->
<div class="sticky-search mb-4">
  <input type="text" id="search" class="form-control search-input" placeholder=" Pesquisar PDF...">
</div>

<!-- Lista de PDFs -->
<div class="row" id="lista"></div>

</div>

<!-- Modal para Preview do PDF -->
<div class="modal fade" id="pdfPreviewModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="pdfPreviewTitle">Pré-visualização do PDF</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="pdf-preview-container" id="pdfPreviewContainer">
          <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Carregando PDF...</span>
            </div>
            <p class="mt-2">Carregando pré-visualização...</p>
          </div>
        </div>
        <div class="pdf-controls">
          <button class="btn btn-outline-primary" id="prevPage">
            <i data-lucide="chevron-left"></i> Anterior
          </button>
          <span class="mx-3">Página: <span id="pageNum">1</span> / <span id="pageCount">1</span></span>
          <button class="btn btn-outline-primary" id="nextPage">
            Próximo <i data-lucide="chevron-right"></i>
          </button>
          <div class="ms-3">
            <label for="zoomLevel" class="form-label me-2">Zoom:</label>
            <select id="zoomLevel" class="form-select form-select-sm d-inline-block" style="width:100px">
              <option value="1">100%</option>
              <option value="1.25">125%</option>
              <option value="1.5">150%</option>
              <option value="2">200%</option>
            </select>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
        <a href="#" id="downloadFromPreview" class="btn btn-primary" target="_blank">
          <i data-lucide="download"></i> Baixar PDF
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Notificação Toast -->
<div class="toast-container position-fixed top-0 end-0 p-3">
  <div id="notificationToast" class="toast" role="alert">
    <div class="toast-header">
      <strong class="me-auto">Biblioteca de PDFs</strong>
      <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
    </div>
    <div class="toast-body"></div>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>

    // Substitua TODO o conteúdo do <script> por este:

// Sistema de Rastreamento (simplificado para demo)
class TrackingSystem {
  constructor() {
    console.log('Sistema de rastreamento iniciado');
  }
  
  trackDownload(pdfId, pdfName) {
    console.log(`Download: ${pdfName} (ID: ${pdfId})`);
  }
  
  trackPreview(pdfId, pdfName) {
    console.log(`Preview: ${pdfName} (ID: ${pdfId})`);
  }
}

// Inicializar tracker
const tracker = new TrackingSystem();

// Carregar e exibir PDFs
async function loadPDFs() {
  try {
    const response = await fetch('pdf.json'); // Nome correto do arquivo
    const pdfs = await response.json();
    
    const container = document.getElementById('lista');
    const searchInput = document.getElementById('search');
    
    function renderPDFs(filter = '') {
      container.innerHTML = '';
      
      const filtered = pdfs.filter(pdf => {
        if (!filter) return true;
        const searchTerm = filter.toLowerCase();
        return (
          (pdf.nome && pdf.nome.toLowerCase().includes(searchTerm)) ||
          (pdf.categoria && pdf.categoria.toLowerCase().includes(searchTerm)) ||
          (pdf.descricao && pdf.descricao.toLowerCase().includes(searchTerm)) ||
          (pdf.tags && pdf.tags.toLowerCase().includes(searchTerm))
        );
      });
      
      if (filtered.length === 0) {
        container.innerHTML = `
          <div class="col-12 text-center py-5">
            <div class="alert alert-info">
              <i data-lucide="search"></i> Nenhum PDF encontrado para "${filter}"
            </div>
          </div>
        `;
        lucide.createIcons();
        return;
      }
      
      filtered.forEach(pdf => {
        const col = document.createElement('div');
        col.className = 'col-md-4 mb-4';
        
        // Verificar se tem prévias
        const temPrevias = pdf.previas && pdf.previas.length > 0;
        
        col.innerHTML = `
          <div class="card h-100">
            ${temPrevias ? `
            <div id="carousel-${pdf.id}" class="carousel slide">
              <div class="carousel-inner">
                ${pdf.previas.map((img, index) => `
                  <div class="carousel-item ${index === 0 ? 'active' : ''}">
                    <img src="${img}" class="d-block w-100" alt="Preview ${index + 1}">
                  </div>
                `).join('')}
              </div>
              ${pdf.previas.length > 1 ? `
              <button class="carousel-control-prev" type="button" data-bs-target="#carousel-${pdf.id}" data-bs-slide="prev">
                <span class="carousel-control-prev-icon"></span>
              </button>
              <button class="carousel-control-next" type="button" data-bs-target="#carousel-${pdf.id}" data-bs-slide="next">
                <span class="carousel-control-next-icon"></span>
              </button>
              ` : ''}
            </div>
            ` : `
            <div class="text-center py-4 bg-light">
              <i data-lucide="file-text" width="60" height="60" class="text-secondary"></i>
              <p class="mt-2 text-muted">Sem pré-visualização</p>
            </div>
            `}
            
            <div class="card-body d-flex flex-column">
              <h5 class="card-title">${pdf.nome || 'Sem título'}</h5>
              <p class="card-text text-muted">${pdf.descricao || 'Sem descrição'}</p>
              <div class="mb-2">
                <span class="badge bg-primary">${pdf.categoria || 'Geral'}</span>
                ${pdf.gratis ? '<span class="badge bg-success ms-1">Gratuito</span>' : '<span class="badge bg-warning ms-1">Pago</span>'}
                ${pdf.tags ? pdf.tags.split(',').map(tag => 
                  `<span class="badge bg-secondary ms-1">${tag.trim()}</span>`
                ).join('') : ''}
              </div>
              <div class="mt-auto">
                <small class="text-muted">
                  <i data-lucide="calendar"></i> ${pdf.data || 'Data não informada'}
                </small>
              </div>
            </div>
            
            <div class="card-footer bg-transparent">
              <div class="d-flex justify-content-between">
                <a href="${pdf.url}" 
                   class="btn btn-primary btn-icon" 
                   target="_blank"
                   onclick="pdfAnalytics.trackPreview(${pdf.id}, '${pdf.nome}')"
                  <i data-lucide="eye"></i> Visualizar
                </a>
                <a href="${pdf.url}" 
                   class="btn btn-success btn-icon" 
                   download
                   onclick="pdfAnalytics.trackDownload(${pdf.id}, '${pdf.nome}')"
                  <i data-lucide="download"></i> Baixar
                </a>
              </div>
            </div>
          </div>
        `;
        
        container.appendChild(col);
      });
      
      // Atualizar ícones
      lucide.createIcons();
    }
    
    // Renderizar inicialmente
    renderPDFs();
    
    // Filtro de pesquisa
    searchInput.addEventListener('input', function() {
      renderPDFs(this.value);
    });
    
  } catch (error) {
    console.error('Erro ao carregar PDFs:', error);
    document.getElementById('lista').innerHTML = `
      <div class="col-12 text-center py-5">
        <div class="alert alert-danger">
          <i data-lucide="alert-circle"></i> Erro ao carregar PDFs. Verifique se o arquivo pdf.json existe.
        </div>
      </div>
    `;
    lucide.createIcons();
  }
}

// Carregar PDFs quando a página carregar
document.addEventListener('DOMContentLoaded', loadPDFs);


    // === SISTEMA DE ANALYTICS ===
class PDFAnalytics {
  constructor() {
    this.storageKey = 'pdf_analytics_data';
    this.initAnalytics();
  }

  initAnalytics() {
    if (!localStorage.getItem(this.storageKey)) {
      const initialData = {
        visits: [],
        previews: [],
        downloads: [],
        visitors: [],
        pdfStats: {}
      };
      localStorage.setItem(this.storageKey, JSON.stringify(initialData));
    }
  }

  getAnalytics() {
    return JSON.parse(localStorage.getItem(this.storageKey)) || {};
  }

  saveAnalytics(data) {
    localStorage.setItem(this.storageKey, JSON.stringify(data));
  }

  trackVisit() {
    const analytics = this.getAnalytics();
    const visit = {
      timestamp: new Date().toISOString(),
      date: new Date().toLocaleDateString('pt-BR'),
      time: new Date().toLocaleTimeString('pt-BR'),
      userAgent: navigator.userAgent,
      referrer: document.referrer || 'direct'
    };

    analytics.visits.push(visit);
    
    if (analytics.visits.length > 1000) {
      analytics.visits = analytics.visits.slice(-1000);
    }

    this.saveAnalytics(analytics);
    return analytics;
  }

  trackPreview(pdfId, pdfName) {
    const analytics = this.getAnalytics();
    const preview = {
      pdfId: pdfId,
      pdfName: pdfName,
      timestamp: new Date().toISOString(),
      date: new Date().toLocaleDateString('pt-BR'),
      time: new Date().toLocaleTimeString('pt-BR')
    };

    analytics.previews.push(preview);
    
    if (!analytics.pdfStats[pdfId]) {
      analytics.pdfStats[pdfId] = {
        name: pdfName,
        previews: 0,
        downloads: 0
      };
    }
    analytics.pdfStats[pdfId].previews++;

    this.saveAnalytics(analytics);
    return analytics;
  }

  trackDownload(pdfId, pdfName) {
    const analytics = this.getAnalytics();
    const download = {
      pdfId: pdfId,
      pdfName: pdfName,
      timestamp: new Date().toISOString(),
      date: new Date().toLocaleDateString('pt-BR'),
      time: new Date().toLocaleTimeString('pt-BR')
    };

    analytics.downloads.push(download);
    
    if (!analytics.pdfStats[pdfId]) {
      analytics.pdfStats[pdfId] = {
        name: pdfName,
        previews: 0,
        downloads: 0
      };
    }
    analytics.pdfStats[pdfId].downloads++;

    this.saveAnalytics(analytics);
    return analytics;
  }
}

// Instanciar o tracker
const analyticsTracker = {
  analytics: new PDFAnalytics(),
  
  trackVisit: function() {
    try {
      const visitData = localStorage.getItem('pdf_analytics_visit');
      if (!visitData || this.isNewDay(visitData)) {
        this.analytics.trackVisit();
        localStorage.setItem('pdf_analytics_visit', new Date().toISOString());
      }
    } catch (e) {
      console.log('Analytics error:', e);
    }
  },
  
  trackPreview: function(pdfId, pdfName) {
    try {
      this.analytics.trackPreview(pdfId, pdfName);
    } catch (e) {
      console.log('Preview tracking error:', e);
    }
  },
  
  trackDownload: function(pdfId, pdfName) {
    try {
      this.analytics.trackDownload(pdfId, pdfName);
    } catch (e) {
      console.log('Download tracking error:', e);
    }
  },
  
  isNewDay: function(lastVisitDate) {
    const lastVisit = new Date(lastVisitDate);
    const now = new Date();
    return lastVisit.getDate() !== now.getDate() || 
           lastVisit.getMonth() !== now.getMonth() || 
           lastVisit.getFullYear() !== now.getFullYear();
  }
};

// Rastrear visita quando a página carregar
document.addEventListener('DOMContentLoaded', function() {
  analyticsTracker.trackVisit();
});
</script>
</body>
  </html>
